<main class="container mt-4">
    <!-- Search Bar -->
    <div class="row mb-4">
        <div class="col-md-8 offset-md-2">
            <div class="input-group">
                <input type="text" 
                        class="form-control" 
                        id="searchInput" 
                        placeholder="Suche nach Rezepten oder Zutaten..."
                        aria-label="Search">
                <button class="btn btn-primary" type="button" id="searchButton">
                    Suche
                </button>
            </div>
        </div>
    </div>

    <!-- Results Container -->
    <div id="resultsContainer" class="d-none">
        <div class="row g-4">
            <!-- Ingredients Column -->
            <div class="col-md-6">
                <h3 class="mb-3">Gefundene Zutaten</h3>
                <div class="row g-4" id="ingredientsResults"></div>
            </div>

            <!-- Recipes Column -->
            <div class="col-md-6">
                <h3 class="mb-3">Gefundene Rezepte</h3>
                <div class="row g-4" id="recipesResults"></div>
            </div>
        </div>
    </div>
</main>

<script>
    async function performSearch() {
        const searchQuery = document.getElementById('searchInput').value.trim();
        if (!searchQuery) return;

        try {
            const formData = new URLSearchParams();
            formData.append('searchQuery', searchQuery);

            const response = await fetch('/api/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                },
                body: formData
            });

            if (!response.ok) throw new Error('Suche fehlgeschlagen');
            
            const { results } = await response.json();
            displayResults(results);

        } catch (error) {
            console.error('Error:', error);
            alert('Ein Fehler ist bei der Suche aufgetreten');
        }
    }

    function displayResults({ ingredients, recepies }) {
        const container = document.getElementById('resultsContainer');
        container.classList.remove('d-none');

        // Clear previous results
        document.getElementById('ingredientsResults').innerHTML = '';
        document.getElementById('recipesResults').innerHTML = '';

        // Display ingredients
        ingredients.forEach(ingredient => {
            const html = `
                <div class="col-md-12 mb-4">
                    <div class="card">
                        <img src="assets/images/ingredient${ingredient.ZUTATENNR}.png" 
                                class="card-img-top" 
                                alt="${ingredient.BEZEICHNUNG}">
                        <div class="card-body">
                            <h5 class="card-title">${ingredient.BEZEICHNUNG}</h5>
                            <p class="card-text">Preis: â‚¬${parseFloat(ingredient.NETTOPREIS).toFixed(2)}</p>
                            <a href="ingredient-detail.php?id=${ingredient.ZUTATENNR}" 
                                class="btn btn-primary">
                                Details
                            </a>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('ingredientsResults').innerHTML += html;
        });

        // Display recipes
        recepies.forEach(recipe => {
            const html = `
                <div class="col-md-12 mb-4">
                    <div class="card">
                        <img src="assets/images/recepie${recipe.REZEPTNR}.png" 
                                class="card-img-top" 
                                alt="${recipe.REZEPT}">
                        <div class="card-body">
                            <h5 class="card-title">${recipe.REZEPT}</h5>
                            <p class="card-text">Portionen: ${recipe.PORTIONEN}</p>
                            <a href="recipe-detail?id=${recipe.REZEPTNR}" 
                                class="btn btn-primary">
                                Details
                            </a>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('recipesResults').innerHTML += html;
        });
    }

    // Event Listeners
    document.getElementById('searchButton').addEventListener('click', performSearch);
    document.getElementById('searchInput').addEventListener('keyup', (e) => {
        if (e.key === 'Enter') performSearch();
    });
</script>
